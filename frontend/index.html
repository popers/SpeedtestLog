<!DOCTYPE html>
<html lang="pl" data-i18n-lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpeedtestLog</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="stylesheet" href="css/main.css">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <div class="app-wrapper">
        <!-- Top Bar -->
        <header class="top-bar">
            <div class="top-bar-left">
                <button id="hamburgerBtn" class="hamburger-btn"><span class="material-symbols-rounded">menu</span></button>
                <a href="/?section=dashboard" class="logo-link">
                    <img src="logo.png" alt="SpeedtestLog Logo" class="logo-img" data-i18n-key="title" data-i18n-attr="alt">
                </a>
            </div>
            <div class="top-bar-actions">
                <div class="watchdog-wrapper">
                    <div id="watchdogIcon" class="watchdog-indicator" title="Ping Watchdog"></div>
                    <div id="watchdogPopover" class="watchdog-popover">
                        <h4 id="wdStatus">...</h4>
                        <div class="wd-detail"><span data-i18n-key="wdTarget">Cel:</span> <span id="wdTarget">...</span></div>
                        <div class="wd-detail"><span data-i18n-key="wdPing">Ping:</span> <span id="wdLatency">...</span></div>
                        <div class="wd-detail"><span data-i18n-key="wdLoss">Pakiety:</span> <span id="wdLoss">...</span></div>
                        <div style="height: 90px; width: 100%; margin-top: 10px;">
                            <canvas id="wdChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="lang-dropdown-wrapper">
                    <button id="langBtn" class="lang-btn">
                        <span class="material-symbols-rounded">language</span>
                        <span id="currentLangText">PL</span>
                    </button>
                    <ul id="langMenu" class="lang-menu">
                        <li data-lang="pl">Polski</li>
                        <li data-lang="en">English</li>
                    </ul>
                </div>
                <button id="themeToggle" title="Zmień motyw" class="theme-btn">
                    <span class="material-symbols-rounded">dark_mode</span>
                </button>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="/?section=dashboard" class="nav-link active"><span class="material-symbols-rounded icon">dashboard</span> <span data-i18n-key="navDashboard">Panel Główny</span></a></li>
                    <li><a href="/?section=charts" class="nav-link"><span class="material-symbols-rounded icon">analytics</span> <span data-i18n-key="historyCharts">Wykresy</span></a></li>
                    <li><a href="/?section=history" class="nav-link"><span class="material-symbols-rounded icon">history</span> <span data-i18n-key="historyTable">Historia Pomiarów</span></a></li>
                    <li><a href="/backup" class="nav-link"><span class="material-symbols-rounded icon">save</span> <span data-i18n-key="navBackup">Kopia Zapasowa</span></a></li>
                    <li><a href="/settings" class="nav-link"><span class="material-symbols-rounded icon">settings</span> <span data-i18n-key="navSettings">Ustawienia</span></a></li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <button id="logoutBtn" class="logout-btn"><span class="material-symbols-rounded icon">logout</span> <span data-i18n-key="logout">Wyloguj</span></button>
                <div style="margin-top: 10px; font-size: 0.75rem; opacity: 0.6;"><small>SpeedtestLog v1.0</small></div>
            </div>
        </aside>

        <main class="main-content">
            <div class="content-scroll" id="contentToCapture">
                <section id="dashboard" class="section-block">
                    <div class="controls-dashboard">
                        <div class="control-group manual-test-group">
                            <label style="visibility: hidden; height: 0; margin: 0;">Action</label>
                            <button id="triggerTestBtn">
                                <img src="speedtest.png" alt="Test Icon" /> 
                                <span class="btn-text" data-i18n-key="runTest">Uruchom Test</span>
                                <span class="btn-dot-loader">
                                    <span class="dot" style="--dot-index:0; --dot-color:var(--color-download);"></span>
                                    <span class="dot" style="--dot-index:1; --dot-color:var(--color-upload);"></span>
                                    <span class="dot" style="--dot-index:2; --dot-color:var(--color-ping);"></span>
                                    <span class="dot" style="--dot-index:3; --dot-color:var(--color-jitter);"></span>
                                </span>
                            </button>
                        </div>
                        <div class="control-group">
                            <label for="serverSelect" data-i18n-key="selectServer">Serwer:</label>
                            <select id="serverSelect"><option value="null" data-i18n-key="autoSelect">Wybór automatyczny</option></select>
                        </div>
                        <div class="control-group">
                            <label for="scheduleSelect" data-i18n-key="runEvery">Interwał:</label>
                            <select id="scheduleSelect">
                                <option value="0" data-i18n-key="intervalDisabled">Wyłączony</option>
                                <option value="1" data-i18n-key="hour1">1 godzina</option>
                                <option value="3" data-i18n-key="hour3">3 godziny</option>
                                <option value="6" data-i18n-key="hour6">6 godzin</option>
                                <option value="12" data-i18n-key="hour12">12 godzin</option>
                                <option value="24" data-i18n-key="hour24">24 godziny</option>
                            </select>
                        </div>
                        <div class="control-group info-group">
                            <label data-i18n-key="nextTest">Następny test:</label>
                            <span id="nextRunTime" class="next-run-indicator" data-i18n-key="calculating">Obliczanie...</span>
                            <small id="nextRunCountdown" class="countdown-timer"></small>
                        </div>
                    </div>

                    <div class="stats-container">
                        <div class="stat-card">
                            <h3><span data-i18n-key="latestDownload">Pobieranie</span></h3>
                            <div class="value-container"><span class="value" id="latestDownloadValue">...</span><span class="unit" id="latestDownloadUnit">Mbps</span></div>
                            <div class="comparison" id="latestDownloadCompare">...</div>
                            <div class="isp-stat" id="latestDownloadISP"></div>
                        </div>
                        <div class="stat-card">
                            <h3><span data-i18n-key="latestUpload">Wysyłanie</span></h3>
                            <div class="value-container"><span class="value" id="latestUploadValue">...</span><span class="unit" id="latestUploadUnit">Mbps</span></div>
                            <div class="comparison" id="latestUploadCompare">...</div>
                            <div class="isp-stat" id="latestUploadISP"></div>
                        </div>
                        <div class="stat-card"><h3><span data-i18n-key="latestPing">Ping</span></h3><div class="value-container"><span class="value" id="latestPingValue">...</span><span class="unit" id="latestPingUnit">ms</span></div><div class="comparison" id="latestPingCompare">...</div></div>
                        <div class="stat-card"><h3><span data-i18n-key="latestJitter">Jitter</span></h3><div class="value-container"><span class="value" id="latestJitterValue">...</span><span class="unit" id="latestJitterUnit">ms</span></div><div class="comparison" id="latestJitterCompare">...</div></div>
                    </div>
                </section>

                <section id="charts" class="section-block">
                    <div class="section-header-inline">
                        <h2 data-i18n-key="historyCharts">Wykresy</h2>
                        <div class="chart-controls">
                             <select id="filterSelect" class="filter-btn"><option value="24h" data-i18n-key="filter24h">Ostatnie 24h</option><option value="7d" data-i18n-key="filter7d">Ostatnie 7 dni</option><option value="30d" data-i18n-key="filter30d">Ostatnie 30 dni</option><option value="all" data-i18n-key="filterAll">Wszystko</option></select>
                             <select id="unitSelect" class="filter-btn"><option value="Mbps">Mbps</option><option value="MBps">MB/s</option></select>
                        </div>
                    </div>
                    <div class="charts-container">
                        <div class="chart-block"><h3 data-i18n-key="downloadChartTitle">Download</h3><canvas id="downloadChart"></canvas></div>
                        <div class="chart-block"><h3 data-i18n-key="uploadChartTitle">Upload</h3><canvas id="uploadChart"></canvas></div>
                        <div class="chart-block"><h3 data-i18n-key="pingChartTitle">Ping</h3><canvas id="pingChart"></canvas></div>
                        <div class="chart-block"><h3 data-i18n-key="jitterChartTitle">Jitter</h3><canvas id="jitterChart"></canvas></div>
                        <div class="chart-block"><h3 data-i18n-key="latencyChartTitle">Opóźnienia (Pod obciążeniem)</h3><canvas id="latencyChart"></canvas></div>
                    </div>
                </section>

                <section id="history" class="section-block">
                    <div class="table-header">
                        <h2 data-i18n-key="historyTable">Historia Pomiarów</h2>
                        <div class="table-actions">
                            <input type="text" id="tableSearch" class="search-input" placeholder="Szukaj..." data-i18n-attr="placeholder" data-i18n-key="searchPlaceholder">
                            <button id="exportBtn" class="action-btn" style="background-color: var(--info-color); border-color: var(--info-color);">
                                <span class="material-symbols-rounded">download</span> 
                                <span data-i18n-key="exportCSV">CSV</span>
                            </button>
                            <button id="deleteSelectedBtn" class="action-btn" style="display: none;">
                                <span class="material-symbols-rounded">delete</span>
                                <span data-i18n-key="deleteSelected">Usuń zaznaczone</span>
                            </button>
                        </div>
                    </div>
                    <div class="table-wrapper">
                        <table id="resultsTable">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" id="selectAllCheckbox"></th>
                                    <th data-i18n-key="tableTime" data-sort="timestamp">Data</th>
                                    <th data-i18n-key="tableDownload" data-sort="download">Download</th>
                                    <th data-i18n-key="tableUpload" data-sort="upload">Upload</th>
                                    <th data-i18n-key="tablePing" data-sort="ping">Ping</th>
                                    <th data-i18n-key="tableJitter" data-sort="jitter">Jitter</th>
                                    <th data-i18n-key="tableServer" data-sort="server_name">Serwer</th>
                                    <th data-i18n-key="tableResultLink">Link</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <div class="pagination-container">
                        <div class="pagination-per-page">
                            <div class="pagination-label" data-i18n-key="rowsPerPage">Na stronę</div>
                            <select id="rowsPerPageSelect" class="pagination-select">
                                <option value="5">5</option>
                                <option value="10" selected>10</option>
                                <option value="25">25</option>
                                <option value="50">50</option>
                                <option value="all" data-i18n-key="filterAll">Wszystko</option>
                            </select>
                        </div>
                        <div class="pagination-nav" id="paginationNav"></div>
                    </div>
                </section>
            </div>
        </main>
        <div class="sidebar-overlay" id="sidebarOverlay"></div>
    </div>
    <div id="toastNotification" class="toast"></div>
    <div id="confirmModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <button id="confirmModalCloseBtn" class="modal-close-x">&times;</button>
            <h3 data-i18n-key="confirmDeleteTitle">Potwierdź</h3>
            <p id="confirmModalText" data-i18n-key="confirmDeleteText">Czy usunąć?</p>
            <div class="modal-buttons">
                <button id="modalCancelBtn" data-i18n-key="modalCancel">Anuluj</button>
                <button id="modalConfirmBtn" data-i18n-key="modalConfirm">Usuń</button>
            </div>
        </div>
    </div>
    <div id="detailsModal" class="modal-overlay" style="display: none;"><div class="modal-content"><button id="modalCloseBtn" class="modal-close-x">&times;</button><h3 data-i18n-key="detailsTitle">Szczegóły</h3><div id="detailsContent" style="text-align: left;"></div></div></div>
    <script type="module" src="js/app.js"></script>
</body>
</html>